package hr.fer.zemris.optjava.dz2;

import Jama.Matrix;

public class ErrorFunction implements IHFunction{
	
	private Matrix systemMatrix;
	private int numOfRows;
	private int numOfColumns;
	private int numOfVariables;
	private Matrix y;
	
	public ErrorFunction(Matrix systemMatrix) {
		this.numOfRows = systemMatrix.getRowDimension();
		this.numOfColumns = systemMatrix.getColumnDimension();
		this.systemMatrix = systemMatrix.getMatrix(0, numOfRows - 1, 0, numOfColumns - 2);
		this.numOfVariables = numOfColumns - 1;
		double[][] yi = new double[numOfRows][1];
		for(int i = 0; i < numOfRows; i++) {
			yi[i][0] = systemMatrix.get(i, numOfColumns - 1);
		}
		y = new Matrix(yi);
	}

	public int getNumberOfVariables() {
		return numOfVariables;
	}

	public double value(Matrix x) {
		if(x.getRowDimension() != systemMatrix.getRowDimension()) {
			throw new IllegalArgumentException("Number of rows of x is wrong!");
		}
		if(x.getColumnDimension() != 1) {
			throw new IllegalArgumentException("x must be vector");
		}
		/*Matrix val = systemMatrix.times(x).minus(y);
		for(int i = 0; i < numOfVariables; i++) {
			val.set(i, 0, Math.pow(val.get(i, 0), 2));
		}
		double ret = 0.0;
		for(int i = 0; i < numOfVariables; i++) {
			ret += val.get(i, 0);
		}
		return ret;*/
		double val = 0.0;
		for(int i = 0; i < numOfRows; i++) {
			for(int j = 0; j < numOfColumns - 1; j++) {
				val += systemMatrix.get(i, j) * x.get(j, 0);
			}
			val = Math.pow(val - y.get(i, 0), 2);
		}
		return val;
	}

	public Matrix getGrad(Matrix x) {
		if(x.getRowDimension() != systemMatrix.getRowDimension()) {
			throw new IllegalArgumentException("Number of rows of x is wrong!");
		}
		if(x.getColumnDimension() != 1) {
			throw new IllegalArgumentException("x must be vector");
		}
		Matrix error = systemMatrix.times(x).minus(y).times(2);
		Matrix grad = new Matrix(numOfRows, 1);
		
		for(int i = 0; i < numOfVariables; i++) {
			double gradi = 0.0;
			for(int j = 0; j < numOfVariables; j++) {
				gradi += error.get(j, 0) * systemMatrix.get(j, i);
			}
			grad.set(i, 0, gradi);
		}
		return grad;
		
		
/*		double[][] grad = new double[numOfVariables][1];
		for(int i = 0; i < numOfRows; i++) {
			for(int j = 0; j < numOfColumns - 1; j++) {
				grad[i][0] += systemMatrix.get(i, j) * x.get(j, 0);
			}
			grad[i][0] = 2 * (grad[i][0] - yi[i]) * x.get(i, 0); 
		}
		return new Matrix(grad);*/
	}

	public Matrix getHesseMatrix(Matrix x) {
		// TODO Auto-generated method stub
		return null;
	}

}